<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>
        <ui:composition template="/template.xhtml"
                        xmlns="http://www.w3.org/1999/xhtml"
                        xmlns:h="http://xmlns.jcp.org/jsf/html"
                        xmlns:p="http://primefaces.org/ui"
                        xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

            <ui:define name="content">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-md-6">

                            <p:panel header="Registro de usuario"
                                     styleClass="shadow p-4 rounded"
                                     style="margin-top: 40px;">

                                <h:form id="clientForm">
                                    <!-- Mostrar mensajes de error -->
                                    <h:messages globalOnly="true" styleClass="alert alert-danger" />

                                    <!-- Switcher para elegir entre Cliente o Refugio -->
                                    <div class="mb-3">
                                        <p:outputLabel for="userType"/>
                                        <p:selectOneButton id="userType" value="#{registerBean.userType}">
                                            <f:selectItem itemLabel="Cliente" itemValue="cliente" />
                                            <f:selectItem itemLabel="Refugio" itemValue="refugio" />
                                            <p:ajax event="change" listener="#{registerBean.onUserTypeChange}" update="@form" />
                                        </p:selectOneButton>
                                    </div>
                                    <div class="mb-3">
                                        <p:outputLabel for="email" value="Email" styleClass="form-label" />
                                        <p:inputText id="email"
                                                     value="#{registerBean.email}"
                                                     required="true"
                                                     styleClass="form-control" />
                                    </div>

                                    <div class="mb-3">
                                        <p:outputLabel for="password" value="Contraseña" styleClass="form-label" />
                                        <p:password id="password"
                                                    value="#{registerBean.password}"
                                                    required="true"
                                                    styleClass="form-control" />
                                    </div>

                                    <!-- Formulario Cliente -->
                                    <p:outputPanel id="clienteFields" layout="block" rendered="#{registerBean.userType eq 'cliente'}">
                                        <div class="mb-3">
                                            <p:outputLabel for="nombre" value="Nombre" styleClass="form-label" />
                                            <p:inputText id="nombre"
                                                         value="#{registerBean.nombre}"
                                                         required="true"
                                                         styleClass="form-control" />
                                        </div>

                                        <div class="mb-3">
                                            <p:outputLabel for="apellidos" value="Apellidos" styleClass="form-label" />
                                            <p:inputText id="apellidos"
                                                         value="#{registerBean.apellidos}"
                                                         required="true"
                                                         styleClass="form-control" />
                                        </div>

                                        <div class="mb-3">
                                            <p:outputLabel for="nif" value="NIF" styleClass="form-label" />
                                            <p:inputText id="nif"
                                                         value="#{registerBean.nif}"
                                                         required="true"
                                                         styleClass="form-control" />
                                        </div>

                                        <div class="mb-3">
                                            <p:outputLabel for="domicilio" value="Domicilio" styleClass="form-label" />
                                            <p:inputText id="domicilio"
                                                         value="#{registerBean.domicilio}"
                                                         required="true"
                                                         styleClass="form-control" />
                                        </div>

                                        <div class="mb-3">
                                            <p:outputLabel for="fechaNacimiento" value="Fecha de Nacimiento" styleClass="form-label" />
                                            <p:calendar id="fechaNacimiento"
                                                        value="#{registerBean.fechaNacimiento}"
                                                        required="true"
                                                        styleClass="form-control" />
                                        </div>
                                    </p:outputPanel>

                                    <!-- Formulario Refugio -->
                                    <p:outputPanel id="refugioFields" layout="block"  rendered="#{registerBean.userType eq 'refugio'}">
                                        <div class="mb-3">
                                            <p:outputLabel for="nombreRefugio" value="Nombre del Refugio" styleClass="form-label" />
                                            <p:inputText id="nombreRefugio"
                                                         value="#{registerBean.nombreRefugio}"
                                                         required="true"
                                                         styleClass="form-control" />
                                        </div>

                                        <div class="mb-3">
                                            <p:outputLabel for="cif" value="CIF" styleClass="form-label" />
                                            <p:inputText id="cif"
                                                         value="#{registerBean.cif}"
                                                         required="true"
                                                         styleClass="form-control" />
                                        </div>

                                        <div class="mb-3">
                                            <p:outputLabel for="direccion" value="Dirección" styleClass="form-label" />
                                            <p:inputText id="direccion"
                                                         value="#{registerBean.direccion}"
                                                         required="true"
                                                         styleClass="form-control" />
                                        </div>
                                    </p:outputPanel>
                                    
                                    <div class="mb-3">
                                        <p:outputLabel for="telefono" value="Teléfono" styleClass="form-label" />
                                        <p:inputText id="telefono"
                                                     value="#{registerBean.telefono}"
                                                     required="true"
                                                     styleClass="form-control" />
                                    </div>
                                    
                                    <!-- Botón de registro -->
                                    <div class="d-grid gap-2">
                                        <p:commandButton value="Registrar" action="#{registerBean.register}" process="@form" update="@form" />

                                    </div>

                                    <div class="text-center mt-3">
                                        <h:outputLink value="login.xhtml" styleClass="link-primary">
                                            ¿Ya tienes cuenta? Inicia sesión aquí
                                        </h:outputLink>
                                    </div>
                                </h:form>

                            </p:panel>

                        </div>
                    </div>
                </div>
            </ui:define>
        </ui:composition>
    </body>
</html>
